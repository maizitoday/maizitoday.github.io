<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="http://maizitoday.github.io//img/home-bg-jeep.jpg">
    <meta property="twitter:image" content="http://maizitoday.github.io//img/home-bg-jeep.jpg" />
    

    
    <meta name="title" content="阿里巴巴Java开发手册笔记" />
    <meta property="og:title" content="阿里巴巴Java开发手册笔记" />
    <meta property="twitter:title" content="阿里巴巴Java开发手册笔记" />
    

    
    <meta name="description" content="代码规范，命名风格，异常日志，MySQL数据库，服务器">
    <meta property="og:description" content="代码规范，命名风格，异常日志，MySQL数据库，服务器" />
    <meta property="twitter:description" content="代码规范，命名风格，异常日志，MySQL数据库，服务器" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="麦子, maizi, maizi, , 麦子的网络日志, 麦子的博客, maizi Blog, 博客, 个人网站, 互联网, Web, 云原生, PaaS, Istio, Kubernetes, 微服务, Microservice">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>阿里巴巴Java开发手册笔记-麦子的博客</title>

    <link rel="canonical" href="/post/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E7%AC%94%E8%AE%B0/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/syntax.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
     
    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>
	
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/docco.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"></a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/categories/english">English</a>
                    </li>
                    
                    <li>
                        <a href="/categories/life">Life</a>
                    </li>
                    
                    <li>
                        <a href="/categories/tech">Tech</a>
                    </li>
                    

                    
                    <li><a href="/top/about/">ABOUT</a></li>
                    


                    
                    <li>
                        <a href="/archive">ARCHIVE</a>
                    </li>
                    


                    
                    <li>
                        <a href="/search">SEARCH <img src="/img/search.png" height="15"
                                style="cursor: pointer;" alt="Search"></a>
                    </li>
                    

                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)

    function handleMagic(e) {
        if ($navbar.className.indexOf('in') > 0) {
            
            $navbar.className = " ";
            
            setTimeout(function () {
                
                if ($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            }, 400)
        } else {
            
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>



<style type="text/css">
    header.intro-header {
        background-image: url('https://zhaohuabing.com//img/post-bg-unix-linux.jpg')
    }


    div.side-catalog nav ul li a {
        display: inline-block;
        vertical-align: middle;
        height: 30px;
        font-size: 17px;
        line-height: 30px;
        overflow: hidden;
        text-decoration: none;
        white-space: nowrap;
        text-overflow: ellipsis;
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/java%E5%9F%BA%E7%A1%80" title="java基础">
                            java基础
                        </a>
                        
                        <a class="tag" href="/tags/%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83" title="开发手册代码规范">
                            开发手册代码规范
                        </a>
                        
                    </div>
                    <h1>阿里巴巴Java开发手册笔记</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by
                        
                        麦子
                        
                        on
                        Tuesday, 2020年05月26日
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-0
                col-md-10 col-md-offset-1
                post-container">

                
                
                
                
                
                
                

<p>[TOC]</p>

<h1 id="编程规范">编程规范</h1>

<h2 id="命名风格">命名风格</h2>

<p><strong>[强制] 常量命名全部大写</strong>，单词间用下划线隔开，力求语义表达完整清楚，不要嫌名字长。 正例：MAX_STOCK_COUNT 反例：MAX_COUNT</p>

<p><strong>[强制]抽象类命名使用 Abstract 或 Base 开头</strong>；异常类命名使用 Exception 结尾；测试类命名以它要测试的类的名称开始，以 Test 结尾。</p>

<p><strong>[强制]中括号是数组类型的一部分</strong>，数组定义如下：</p>

<pre><code class="language-java">String[] a
</code></pre>

<p>反例：</p>

<pre><code class="language-java">使用 String args[]的方式来定义。
</code></pre>

<p><strong>[强制]POJO 类中布尔类型的变量，都不要加 is，否则部分框架解析会引起序列化错误。</strong></p>

<p>反例：</p>

<p>定义为基本数据类型 Boolean isDeleted；的属性，它的方法也是 isDeleted()，RPC框架在反向解析的时候，“以为”对应的属性名称是 deleted，导致属性获取不到，进而抛出异常。</p>

<p><strong>[推荐]如果模块、接口、类、方法使用了设计模式，在命名时体现出具 说明</strong>：将设计模式体现在名字中，有利于阅读者快速理解架构设计理念。</p>

<p>正例：</p>

<pre><code class="language-java">public class OrderFactory;

public class LoginProxy;

public class ResourceObserver;
</code></pre>

<p><strong>[推荐]接口类中的方法和属性不要加任何修饰符号（public 也不要加），保持代码的简洁 性，并加上有效的 Javadoc 注释。尽量不要在接口里定义变量，如果一定要定义变量，肯定是 与接口方法相关，并且是整个应用的基础常量。</strong></p>

<p>正例：</p>

<pre><code class="language-java">接口方法签名：void f();
接口基础常量表示：String COMPANY = &quot;alibaba&quot;;
</code></pre>

<p>反例：</p>

<p>接口方法定义：</p>

<pre><code class="language-java">public abstract void f(); 
</code></pre>

<p>说明：JDK8 中接口允许有默认实现，那么这个 default 方法，是对所有实现类都有价值的默 认实现。</p>

<p><strong>接口和实现类的命名有两套规则</strong></p>

<p><strong>[强制]对于 Service 和 DAO 类，基于 SOA 的理念，暴露出来的服务一定是接口，内部 的实现类用 Impl 的后缀与接口区别。</strong></p>

<p>正例：</p>

<pre><code class="language-java">CacheServiceImpl 实现 CacheService 接口。
</code></pre>

<p><strong>[推荐] 如果是形容能力的接口名称，取对应的形容词做接口名（通常是–able 的形式）</strong>。</p>

<p>正例：</p>

<pre><code class="language-java">AbstractTranslator 实现 Translatable。
</code></pre>

<p><strong>[参考]枚举类名建议带上 Enum 后缀，枚举成员名称需要全大写，单词间用下划线隔开。</strong></p>

<p>说明：枚举其实就是特殊的常量类，且构造方法被默认强制是私有。</p>

<p>正例：</p>

<pre><code class="language-java">枚举名字为 ProcessStatusEnum 的成员名称：SUCCESS / UNKNOWN_REASON。
</code></pre>

<h3 id="参考-各层命名规约"><strong>[参考]各层命名规约：</strong></h3>

<p><strong>A) Service/DAO 层方法命名规约</strong></p>

<pre><code class="language-java">1） 获取单个对象的方法用 get 做前缀。 

2） 获取多个对象的方法用 list 做前缀。 

3） 获取统计值的方法用 count 做前缀。

4） 插入的方法用 save/insert 做前缀。

5） 删除的方法用 remove/delete 做前缀。 

6） 修改的方法用 update 做前缀。
</code></pre>

<p><strong>B) 领域模型命名规约</strong></p>

<pre><code class="language-java">1） 数据对象：xxxDO，xxx 即为数据表名。

2） 数据传输对象：xxxDTO，xxx 为业务领域相关的名称。 

3） 展示对象：xxxVO，xxx 一般为网页名称。 

4） POJO 是 DO/DTO/BO/VO 的统称，禁止命名成 xxxPOJO。
</code></pre>

<h2 id="常量定义">常量定义</h2>

<p><strong>[强制]不允许任何魔法值（即未经定义的常量）直接出现在代码中。</strong></p>

<p>反例：</p>

<pre><code class="language-java">String key = &quot;Id#taobao_&quot; + tradeId;
cache.put(key, value);
</code></pre>

<p><strong>[强制]long 或者 Long 初始赋值时，使用大写的 L，不能是小写的 l，小写容易跟数字 1 混 淆，造成误解。</strong></p>

<p>说明：</p>

<pre><code class="language-java">Long a = 2l; 写的是数字的 21，还是 Long 型的 2?
</code></pre>

<p><strong>[推荐]不要使用一个常量类维护所有常量，按常量功能进行归类，分开维护。</strong></p>

<p>说明：</p>

<pre><code class="language-java">大而全的常量类，非得使用查找功能才能定位到修改的常量，不利于理解和维护。
</code></pre>

<p>正例：</p>

<pre><code class="language-java">缓存相关常量放在类 CacheConsts 下；系统配置相关常量放在类 ConfigConsts 下。
</code></pre>

<p><strong>[推荐]如果变量值仅在一个范围内变化，且带有名称之外的延伸属性，定义为枚举类。</strong></p>

<p>下面 正例中的数字就是延伸信息，表示星期几。</p>

<p>正例：</p>

<pre><code class="language-java">public Enum { 
         MONDAY(1), TUESDAY(2), WEDNESDAY(3), THURSDAY(4), FRIDAY(5), SATURDAY(6),SUNDAY(7);
}
</code></pre>

<h2 id="代码格式">代码格式</h2>

<p><strong>[强制] 左小括号和字符之间不出现空格；同样，右小括号和字符之间也不出现空格。</strong></p>

<p>反例：</p>

<pre><code class="language-java">if (空格a == b空格)
</code></pre>

<p><strong>[强制一个空格。</strong></p>

<p>正例：</p>

<pre><code class="language-java">// 注释内容，注意在和注释内容之间有一个空格。//
</code></pre>

<h2 id="oop-规约">OOP 规约</h2>

<p><strong>[强制]避免通过一个类的对象引用访问此类的静态变量或静态方法，无谓增加编译器解析成 本，直接用类名来访问即可。</strong></p>

<p><strong>[强制]所有的覆写方法，必须加@Override 注解。</strong></p>

<p>说明：</p>

<pre><code class="language-java">getObject()与 get0bject()的问题。一个是字母的 O，一个是数字的 0，加@Override可以准确判断是否覆盖成功。另外，如果在抽象类中对方法签名进行修改，其实现类会马上编 译报错。
</code></pre>

<p><strong>[强制]相同参数类型，相同业务含义，才可以使用 Java 的可变参数，避免使用 Object。</strong></p>

<p>说明：</p>

<pre><code class="language-java">可变参数必须放置在参数列表的最后。（提倡同学们尽量不用可变参数编程） 
</code></pre>

<p>正例：</p>

<pre><code class="language-java">public User getUsers(String type, Integer... ids) {...}
</code></pre>

<p><strong>[强制]所有的相同类型的包装类对象之间值的比较，全部使用 equals 方法比较。</strong></p>

<p>说明：</p>

<pre><code class="language-java">对于 Integer var = ? 在-128 至 127 范围内的赋值，Integer 对象是在IntegerCache.cache 产生，会复用已有对象，这个区间内的 Integer 值可以直接使用==进行判断，但是这个区间之外的所有数据，都会在堆上产生，并不会复用已有对象，这是一个大坑， 推荐使用 equals 方法进行判断。
</code></pre>

<h3 id="关于基本数据类型与包装数据类型的使用标准如下">关于基本数据类型与包装数据类型的使用标准如下：</h3>

<p>1） [强制]所有的 POJO 类属性必须使用包装数据类型。</p>

<p>2） [强制]RPC 方法的返回值和参数必须使用包装数据类型。</p>

<p>3） [推荐]所有的局部变量使用基本数据类型。</p>

<p>说明：</p>

<pre><code class="language-java">POJO 类属性没有初值是提醒使用者在需要使用时，必须自己显式地进行赋值，任何 NPE 问题，或者入库检查，都由使用者来保证。 正例：数据库的查询结果可能是 null，因为自动拆箱，用基本数据类型接收有 NPE 风险。 反例：比如显示成交总额涨跌情况，即正负 x%，x 为基本数据类型，调用的 RPC 服务，调用 不成功时，返回的是默认值，页面显示为 0%，这是不合理的，应该显示成中划线。所以包装 数据类型的 null 值，能够表示额外的信息，如：远程调用失败，异常退出。
</code></pre>

<p><strong>[强制]定义 DO/DTO/VO 等 POJO 类时，不要设定任何属性默认值。</strong></p>

<p>反例：</p>

<pre><code class="language-java">POJO 类的 gmtCreate 默认值为 new Date();但是这个属性在数据提取时并没有置入具 体值，在更新其它字段时又附带更新了此字段，导致创建时间被修改成当前时间。
</code></pre>

<p><strong>[强制]序列化类新增属性时，请不要修改 serialVersionUID 字段，避免反序列失败；</strong></p>

<pre><code class="language-java">如果完全不兼容升级，避免反序列化混乱，那么请修改 serialVersionUID 值。 说明：注意 serialVersionUID 不一致会抛出序列化运行时异常。
</code></pre>

<p><strong>[强制]构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在 init 方法中。</strong></p>

<p><strong>[强制]POJO 类必须写 toString 方法。</strong></p>

<pre><code class="language-java">使用 IDE 的中工具：source&gt; generate toString时，如果继承了另一个 POJO 类，注意在前面加一下 super.toString。 说明：在方法执行抛出异常时，可以直接调用 POJO 的 toString()方法打印其属性值，便于排 查问题。
</code></pre>

<p><strong>[推荐]setter 方法中，参数名称与类成员变量名称一致，this.成员名 = 参数名</strong>。</p>

<pre><code>在getter/setter 方法中，不要增加业务逻辑，增加排查问题的难度。
</code></pre>

<p>反例：</p>

<pre><code class="language-java">  public Integer getData() {

        if (true) {
            return this.data + 100;

        } else {
            return this.data - 100;
        }
    }
</code></pre>

<p><strong>[推荐]循环体内，字符串的连接方式，使用 StringBuilder 的 append 方法进行扩展。</strong></p>

<p>说明：</p>

<pre><code class="language-java">反编译出的字节码文件显示每次循环都会 new 出一个 StringBuilder 对象，然后进行 append 操作，最后通过 toString 方法返回 String 对象，造成内存资源浪费。
</code></pre>

<p>反例：</p>

<pre><code class="language-java">String str = &quot;start&quot;;
for (int i = 0; i &lt; 100; i++) {
    str = str + &quot;hello&quot;;
}
</code></pre>

<p><strong>[推荐]final可以声明类、成员变量、方法、以及本地变量，下列情况使用final关键字：</strong></p>

<pre><code>1） 如果不允许外部直接通过 new 来创建对象，那么构造方法必须是 private。
2） 工具类不允许有 public 或 default 构造方法。
3） 类非 static 成员变量并且与子类共享，必须是 protected。
4） 类非 static 成员变量并且仅在本类使用，必须是 private。
5） 类 static 成员变量如果仅在本类使用，必须是 private。
6） 若是 static 成员变量，必须考虑是否为 final。
7） 类成员方法只供类内部调用，必须是 private。
8） 类成员方法只对继承类公开，那么限制为 protected。
</code></pre>

<p><strong>说明</strong>：任何类、方法、参数、变量，严控访问范围。过于宽泛的访问范围，不利于模块解耦。</p>

<p>思考：如果是一个 private 的方法，想删除就删除，可是一个 public 的 service 方法，或者 一个 public 的成员变量，删除一下，不得手心冒点汗吗？变量像自己的小孩，尽量在自己的 视线内，变量作用域太大，无限制的到处跑，那么你会担心的。</p>

<p><strong>[推荐]类成员与方法访问控制从严</strong>：</p>

<pre><code>1） 如果不允许外部直接通过 new 来创建对象，那么构造方法必须是 private。
2） 工具类不允许有 public 或 default 构造方法。
3） 类非 static 成员变量并且与子类共享，必须是 protected。
4） 类非 static 成员变量并且仅在本类使用，必须是 private。
5） 类 static 成员变量如果仅在本类使用，必须是 private。
6） 若是 static 成员变量，必须考虑是否为 final。
7） 类成员方法只供类内部调用，必须是 private。
8） 类成员方法只对继承类公开，那么限制为 protected。

</code></pre>

<p>说明：</p>

<p>任何类、方法、参数、变量，严控访问范围。过于宽泛的访问范围，不利于模块解耦。 思考：如果是一个 private 的方法，想删除就删除，可是一个 public 的 service 方法，或者 一个 public 的成员变量，删除一下，不得手心冒点汗吗？变量像自己的小孩，尽量在自己的 视线内，变量作用域太大，无限制的到处跑，那么你会担心的。</p>

<h2 id="集合处理">集合处理</h2>

<p><strong>[强制]关于 hashCode 和 equals 的处理，遵循如下规则：</strong></p>

<pre><code class="language-java">1） 只要重写 equals，就必须重写 hashCode。 
2） 因为 Set 存储的是不重复的对象，依据 hashCode 和 equals 进行判断，所以 Set 存储的对象必须重写这两个方法。
3） 如果自定义对象做为 Map 的键，那么必须重写 hashCode 和 equals。
</code></pre>

<p>说明：</p>

<p>String 重写了 hashCode 和 equals 方法，所以我们可以非常愉快地使用 String 对象作为 key 来使用。</p>

<p><strong>[强制]使用工具类 Arrays.asList()把数组转换成集合时，不能使用其修改集合相关的方法，它的 add/remove/clear 方法会抛出 UnsupportedOperationException 异常。</strong></p>

<p>说明：</p>

<pre><code class="language-java">asList 的返回对象是一个 Arrays 内部类，并没有实现集合的修改方法。Arrays.asList体现的是适配器模式，只是转换接口，后台的数据仍是数组。
String[] str = new String[] { &quot;you&quot;, &quot;wu&quot; }; 
List list = Arrays.asList(str); 
第一种情况：list.add(&quot;yangguanbao&quot;); 运行时异常。
第二种情况：str[0] = &quot;gujin&quot;; 那么 list.get(0)也会随之修改。
</code></pre>

<p><strong>[强制]泛型通配符&lt;? extends T&gt;来接收返回的数据，此写法的泛型集合不能使用 add 方 法，而&lt;? super T&gt;不能使用 get 方法，做为接口调用赋值时易出错。</strong></p>

<p>说明：</p>

<pre><code class="language-java">扩展说一下 PECS(Producer Extends Consumer Super)原则：第一、频繁往外读取内容的，适合用&lt;? extends T&gt;。第二、经常往里插入的，适合用&lt;? super T&gt;。
</code></pre>

<p><strong>[强制]不要在 foreach 循环里进行元素的 remove/add 操作。</strong></p>

<p>remove 元素请使用 Iterator方式，如果并发操作，需要对 Iterator 对象加锁。</p>

<p>正例：</p>

<pre><code class="language-java">  Iterator&lt;String&gt; iterator = list.iterator();

        while (iterator.hasNext()) {

            String item = iterator.next();

            if (删除元素的条件) {

                iterator.remove();

            }

        }
</code></pre>

<p>反例：</p>

<pre><code class="language-java">List&lt;String&gt; list = new ArrayList&lt;String&gt;();

    list.add(&quot;1&quot;);

    list.add(&quot;2&quot;);

    for (String item : list) {

    if (&quot;1&quot;.equals(item)) {

    list.remove(item);

    }

}
</code></pre>

<p>说明：以上代码的执行结果肯定会出乎大家的意料，那么试一下把“1”换成“2”，会是同样的 结果吗？</p>

<p><strong>[推荐]集合初始化时，指定集合初始值大小。</strong></p>

<p>说明：</p>

<pre><code class="language-java">HashMap 使用 HashMap(int initialCapacity) 初始化，
</code></pre>

<p>正例：</p>

<pre><code>initialCapacity=(需要存储的元素个数 / 负载因子) + 1。注意负载因子（即 loaderfactor）默认为0.75，如果暂时无法确定初始值大小，请设置为16（即默认值）。
</code></pre>

<p>反例：</p>

<pre><code class="language-java">HashMap需要放置1024个元素，由于没有设置容量初始大小，随着元素不断增加，容量 7 次被迫扩大，resize需要重建hash表，严重影响性能。
</code></pre>

<p><strong>[推荐]使用 entrySet 遍历 Map 类集合 KV，而不是 keySet 方式进行遍历。</strong></p>

<p>说明：</p>

<pre><code class="language-java">keySet 其实是遍历了 2 次，一次是转为 Iterator 对象，另一次是从 hashMap 中取出 key 所对应的 value。而 entrySet 只是遍历了一次就把 key 和 value 都放到了 entry 中，效率更高。如果是 JDK8，使用 Map.foreach 方法。
</code></pre>

<p>正例：</p>

<pre><code class="language-java">values()返回的是 V 值集合，是一个 list 集合对象；keySet()返回的是 K 值集合，是一个 Set 集合对象；entrySet()返回的是 K-V 值组合集合。
</code></pre>

<p><strong>[推荐]高度注意 Map 类集合 K/V 能不能存储 null 值的情况，如下表格：</strong></p>

<p><img src="/img/Xnip2020-05-26_13-53-28.png" alt="Xnip2020-05-26_13-53-28" /></p>

<p>反例：</p>

<pre><code class="language-java">由于 HashMap 的干扰，很多人认为 ConcurrentHashMap 是可以置入 null 值，而事实上， 存储 null 值时会抛出 NPE 异常。
</code></pre>

<h2 id="并发处理">并发处理</h2>

<p><strong>[强制]获取单例对象需要保证线程安全，其中的方法也要保证线程安全。</strong></p>

<p>说明：</p>

<pre><code class="language-java">资源驱动类、工具类、单例工厂类都需要注意。
</code></pre>

<p><strong>[强制]线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。</strong></p>

<p>说明：</p>

<pre><code class="language-java">使用线程池的好处是减少在创建和销毁线程上所花的时间以及系统资源的开销，解决资 源不足的问题。如果不使用线程池，有可能造成系统创建大量同类线程而导致消耗完内存或者 “过度切换”的问题。
</code></pre>

<p><strong>[强制]线程池不允许使用Executors去创建，而是通过ThreadPoolExecutor的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。</strong></p>

<p>说明：</p>

<pre><code>Executors返回的线程池对象的弊端如下：
1）FixedThreadPool和SingleThreadPool:允许的请求队列长度为Integer.MAX_VALUE，可能会堆积大量的请求，从而导致OOM。
2）CachedThreadPool和ScheduledThreadPool:允许的创建线程数量为Integer.MAX_VALUE，可能会创建大量的线程，从而导致 OOM。

</code></pre>

<p><strong>[强制]SimpleDateFormat 是线程不安全的类，一般不要定义为 static 变量，如果定义为static，必须加锁，或者使用 DateUtils 工具类。</strong></p>

<p>正例：</p>

<pre><code class="language-java">注意线程安全，使用 DateUtils。亦推荐如下处理：

  private static final ThreadLocal&lt;DateFormat&gt; df = new ThreadLocal&lt;DateFormat&gt;() {

        @Override

        protected DateFormat initialValue() {

            return new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);

        }

    };

</code></pre>

<p>说明：</p>

<pre><code class="language-java">如果是 JDK8 的应用，可以使用 Instant 代替 Date，LocalDateTime 代替 Calendar， DateTimeFormatter 代替 SimpleDateFormat，官方给出的解释：simple beautiful strong immutable thread-safe。
</code></pre>

<p><strong>[强制]高并发时，同步调用应该去考量锁的性能损耗。能用无锁数据结构，就不要用锁；能 锁区块，就不要锁整个方法体；能用对象锁，就不要用类锁。</strong></p>

<p>说明：</p>

<pre><code class="language-java">尽可能使加锁的代码块工作量尽可能的小，避免在锁代码块中调用 RPC 方法。
</code></pre>

<p><strong>[强制]对多个资源、数据库表、对象同时加锁时，需要保持一致的加锁顺序，否则可能会造 成死锁。</strong></p>

<p>说明：</p>

<pre><code class="language-java">线程一需要对表 A、B、C 依次全部加锁后才可以进行更新操作，那么线程二的加锁顺序 也必须是 A、B、C，否则可能出现死锁。
</code></pre>

<p><strong>[强制]并发修改同一记录时，避免更新丢失，需要加锁。要么在应用层加锁，要么在缓存加 锁，要么在数据库层使用乐观锁，使用 version 作为更新依据。</strong></p>

<p>说明：</p>

<pre><code class="language-java">如果每次访问冲突概率小于 20%，推荐使用乐观锁，否则使用悲观锁。乐观锁的重试次 数不得小于 3 次。
</code></pre>

<p><strong>[推荐]使用 CountDownLatch 进行异步转同步操作，每个线程退出前必须调用 countDown方法，线程执行代码注意 catch 异常，确保 countDown 方法被执行到，避免主线程无法执行 至 await 方法，直到超时才返回结果。</strong></p>

<p>说明：</p>

<pre><code class="language-java">注意，子线程抛出异常堆栈，不能在主线程 try-catch 到。
</code></pre>

<p><strong>[推荐]避免 Random 实例被多线程使用，虽然共享该实例是线程安全的，但会因竞争同一seed 导致的性能下降。</strong></p>

<p>说明：</p>

<pre><code class="language-java">Random 实例包括 java.util.Random 的实例或者 Math.random()的方式。 
</code></pre>

<p>正例：</p>

<pre><code class="language-java">在 JDK7 之后，可以直接使用 API ThreadLocalRandom，而在 JDK7 之前，需要编码保证每个线程持有一个实例。
</code></pre>

<p><strong>[参考]volatile 解决多线程内存不可见问题。对于一写多读，是可以解决变量同步问 但是如果多写，同样无法解决线程安全问题。</strong></p>

<p>如果是 count++操作，使用如下类实现：</p>

<pre><code class="language-java">AtomicInteger count = new AtomicInteger(); count.addAndGet(1); 
</code></pre>

<p>如果是 JDK8，推荐使用 LongAdder 对象，比 AtomicLong 性能更好（减少乐观锁的重试次数）。</p>

<p><strong>[参考]ThreadLocal 无法解决共享对象的更新问题，ThreadLocal 对象建议使用 static修饰。这个变量是针对一个线程内所有操作共享的，所以设置为静态变量，所有此类实例共享 此静态变量 ，也就是说在类第一次被使用时装载，只分配一块存储空间，所有此类的对象(只 要是这个线程内定义的)都可以操控这个变量。</strong></p>

<h2 id="注释规约">注释规约</h2>

<p><strong>[强制]所有的抽象方法（包括接口中的方法）必须要用 Javadoc 注释、除了返回值、参数、 异常说明外，还必须指出该方法做什么事情，实现什么功能。</strong></p>

<p>说明：</p>

<pre><code class="language-java">对子类的实现要求，或者调用注意事项，请一并说明。
</code></pre>

<p><strong>[强制]所有的类都必须添加创建者和创建日期。</strong></p>

<p><strong>[强制]所有的枚举类型字段必须要有注释，说明每个数据项的用途。</strong></p>

<h2 id="其它">其它</h2>

<p><strong>[强制]velocity 调用 POJO 类的属性时，建议直接使用属性名取值即可，模板引擎会自动按 规范调用 POJO 的 getXxx()，如果是 boolean 基本数据类型变量（boolean 命名不需要加 is前缀），会自动调用 isXxx()方法。</strong></p>

<p>说明：</p>

<pre><code class="language-java">注意如果是 Boolean 包装类对象，优先调用 getXxx()的方法。
</code></pre>

<p><strong>[强制]获取当前毫秒数 System.currentTimeMillis(); 而不是 new Date().get</strong></p>

<p>说明：</p>

<pre><code class="language-java">如果想获取更加精确的纳秒级时间值，使用 System.nanoTime()的方式。在 JDK8 中， 针对统计时间等场景，推荐使用 Instant 类。
</code></pre>

<p><strong>[推荐]任何数据结构的构造或初始化，都应指定大小，避免数据结构无限增长吃光内存。</strong></p>

<h1 id="异常日志">异常日志</h1>

<h2 id="异常处理">异常处理</h2>

<p><strong>[强制]异常不要用来做流程控制，条件控制，因为异常的处理效率比条件分支低。</strong></p>

<p><strong>[强制]对大段代码进行 try-catch，这是不负责任的表现。catch 时请分清稳定代码和非稳 定代码，稳定代码指的是无论如何不会出错的代码。对于非稳定代码的 catch 尽可能进行区分 异常类型，再做对应的异常处理。</strong></p>

<p><strong>[强制]捕获异常是为了处理它，不要捕获了却什么都不处理而抛弃之，如果不想处理它，请 将该异常抛给它的调用者。最外层的业务使用者，必须处理异常，将其转化为用户可以理解的 内容。</strong></p>

<p><strong>[强制]有 try 块放到了事务代码中，catch 异常后，如果需要回滚事务，一定要注意手动回 滚事务。</strong></p>

<p><strong>[强制]不能在 finally 块中使用 return，finally 块中的 return 返回后方法结束执行，不会再执行 try 块中的 return 语句。</strong></p>

<p><strong>[参考]在代码中使用“抛异常”还是“返回错误码”，对于公司外的 http/api 开放接口必须 使用“错误码”；而应用内部推荐异常抛出；跨应用间 RPC 调用优先考虑使用 Result 方式，封 装 isSuccess()方法、“错误码”、“错误简短信息”。</strong></p>

<p>说明：</p>

<pre><code class="language-java">关于 RPC 方法返回方式使用 Result 方式的理由：
1）使用抛异常返回方式，调用方如果没有捕获到就会产生运行时错误。
2）如果不加栈信息，只是 new 自定义异常，加入自己的理解的 error message，对于调用 端解决问题的帮助不会太多。如  果加了栈信息，在频繁调用出错的情况下，数据序列化和传输 的性能损耗也是问题。
</code></pre>

<p><strong>[参考]避免出现重复的代码（Don’t Repeat Yourself），即 DRY 原则。</strong></p>

<p>说明：</p>

<pre><code class="language-java">随意复制和粘贴代码，必然会导致代码的重复，在以后需要修改时，需要修改所有的副 本，容易遗漏。必要时抽取共性方法，或者抽象公共类，甚至是组件化。
</code></pre>

<p>正例：</p>

<pre><code class="language-java">一个类中有多个 public 方法，都需要进行数行相同的参数校验操作，这个时候请抽取：
private boolean checkParam(DTO dto) {...}
</code></pre>

<h2 id="日志规约">日志规约</h2>

<p><strong>[强制]应用中不可直接使用日志系统（Log4j、Logback）中的 API，而应依赖使用日志框架 SLF4J 中的 API，使用门面模式的日志框架，有利于维护和各个类的日志处理方式统一。</strong></p>

<pre><code class="language-java">import org.slf4j.Logger;

import org.slf4j.LoggerFactory;

private static final Logger logger = LoggerFactory.getLogger(Abc.class);
</code></pre>

<p><strong>[强制]应用中的扩展日志（如打点、临时监控、访问日志等）命名方式： appName_logType_logName.log。logType:日志类型，推荐分类有stats/desc/monitor/visit 等；logName:日志描述。</strong></p>

<p>这种命名的好处：通过文件名就可知道日志文件属于什么应用，什么类型，什么目的，也有利于归类查找。</p>

<p>正例：</p>

<pre><code class="language-java">mppserver 应用中单独监控时区转换异常，如： mppserver_monitor_timeZoneConvert.log
</code></pre>

<p>说明：</p>

<pre><code class="language-java">推荐对日志进行分类，如将错误日志和业务日志分开存放，便于开发人员查看，也便于 通过日志对系统进行及时监控。
</code></pre>

<p><strong>[强制]避免重复打印日志，浪费磁盘空间，务必在 log4j.xml 中设置 additivity=false。</strong></p>

<p>正例：</p>

<pre><code class="language-xml">&lt;logger name=&quot;com.taobao.dubbo.config&quot; additivity=&quot;false&quot;&gt;
</code></pre>

<p><strong>[强制]异常信息应该包括两类信息：案发现场信息和异常堆栈信息。如果不处理，那么 关键字 throws 往上抛出。</strong></p>

<p>正例：</p>

<pre><code class="language-java">logger.error(各类参数或者对象 toString + &quot;_&quot; + e.getMessage(), e);
</code></pre>

<p><strong>[推荐]谨慎地记录日志。生产环境禁止输出 debug 日志；有选择地输出 info 日志；如果使 用 warn 来记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免把服务器磁盘 撑爆，并记得及时删除这些观察日志。</strong></p>

<p>说明：</p>

<pre><code class="language-java">大量地输出无效日志，不利于系统性能提升，也不利于快速定位错误点。记录日志时请 思考：这些日志真的有人看吗？看到这条日志你能做什么？能不能给问题排查带来好处？
</code></pre>

<p><strong>[强制]表单、AJAX 提交必须执行 CSRF 安全过滤。 说明：CSRF(Cross-site request forgery)跨站请求伪造是一类常见编程漏洞。对于存在CSRF 漏洞的应用/网站，攻击者可以事先构造好 URL，只要受害者用户一访问，后台便在用户 不知情情况下对数据库中用户参数进行相应修改。</strong></p>

<p><strong>[强制]在使用平台资源，譬如短信、邮件、电话、下单、支付，必须实现正确的防重放限制， 如数量限制、疲劳度控制、验证码校验，避免被滥刷、资损。 说明：如注册时发送验证码到手机，如果没有限制次数和频率，那么可以利用此功能骚扰到其 它用户，并造成短信平台资源浪费。</strong></p>

<p><strong>[推荐]发贴、评论、发送即时消息等用户生成内容的场景必须实现防刷、文本内容违禁词过滤等风控策略。</strong></p>

<h1 id="mysql-数据库">MySQL 数据库</h1>

<h2 id="建表规约">建表规约</h2>

<p><strong>[强制]表达是与否概念的字段，必须使用 is_xxx 的方式命名，数据类型是 unsigned tinyint （ 1 表示是，0 表示否）。</strong></p>

<p>说明：</p>

<pre><code class="language-java">任何字段如果为非负数，必须是 unsigned。
</code></pre>

<p>正例：</p>

<pre><code class="language-java">表达逻辑删除的字段名is_deleted，1 表示删除，0 表示未删除。
</code></pre>

<p><strong>[强制]表名、字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只 出现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。</strong></p>

<p>说明：</p>

<pre><code>MySQL 在 Windows 下不区分大小写，但在 Linux 下默认是区分大小写。因此，数据库名、表名、字段名，都不允许出现任何大写字母，避免节外生枝。
</code></pre>

<p>正例：</p>

<pre><code class="language-java">aliyun_admin，rdc_config，level3_name 反例：AliyunAdmin，rdcConfig，level_3_name
</code></pre>

<p><strong>[强制]主键索引名为 pk_字段名；唯一索引名为 uk_字段名；普通索引名则为 idx_字段名。</strong> </p>

<p>说明：</p>

<pre><code class="language-java">pk_ 即 primary key；uk_ 即 unique key；idx_ 即 index 的简称。
</code></pre>

<p><strong>[强制]小数类型为 decimal，禁止使用 float 和 double。</strong></p>

<p>说明：</p>

<pre><code class="language-java">float 和 double 在存储的时候，存在精度损失的问题，很可能在值的比较时，得到不 正确的结果。如果存储的数据范围超过 decimal 的范围，建议将数据拆成整数和小数分开存储。
</code></pre>

<p><strong>[强制]如果存储的字符串长度几乎相等，使用 char 定长字符串类型。</strong></p>

<p><strong>[强制]varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长 度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索 引效率。</strong></p>

<p><strong>[强制]表必备三字段：id  ,  gmt_create,  gmt_modified</strong></p>

<p>说明：</p>

<pre><code>其中idgmt_modified动更新。必为主键，类型为unsigned bigint、单表时自增、步长为1。gmt_create,gmt_modified的类型均为date_time类型,前者现在时表示主动创建，后者过去分词表示被动更新
</code></pre>

<p><strong>[推荐]表的命名最好是加上“业务名称_表的作用”。</strong></p>

<p>正例：</p>

<pre><code class="language-java">alipay_task / force_project / trade_config
</code></pre>

<p><strong>[推荐]库名与应用名称尽量一致。</strong></p>

<p><strong>[推荐]如果修改字段含义或对字段表示的状态追加时，需要及时更新字段注释。</strong></p>

<p><strong>[推荐]单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。 说明：如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表。</strong></p>

<p><strong>[参考]合适的字符存储长度，不但节约数据库表空间、节约索引存储，更重要的是提升检 索速度。</strong></p>

<p>正例：</p>

<p>如下表，其中无符号值可以避免误存负数，且扩大了表示范围。</p>

<p><img src="/img/Xnip2020-05-26_14-23-13.png" alt="Xnip2020-05-26_14-23-13" /></p>

<h2 id="索引规约">索引规约</h2>

<p><strong>[强制]业务上具有唯一特性的字段，即使是多个字段的组合，也必须建成唯一索引。</strong></p>

<p>说明：</p>

<pre><code class="language-java">不要以为唯一索引影响了 insert 速度，这个速度损耗可以忽略，但提高查找速度是明 显的；另外，即使在应用层做了非常完善的校验控制，只要没有唯一索引，根据墨菲定律，必 然有脏数据产生。
</code></pre>

<p><strong>[强制]超过三个表禁止 join。需要 join 的字段，数据类型必须绝对一致；多表关联查询时， 保证被关联的字段需要有索引。</strong></p>

<p>说明：即使双表 join 也要注意表索引、SQL 性能。</p>

<p><strong>[强制]在 varchar 字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据 实际文本区分度决定索引长度即可。</strong></p>

<p>说明：</p>

<pre><code class="language-java">索引的长度与区分度是一对矛盾体，一般对字符串类型数据，长度为 20 的索引，区分度会高达 90%以上，可以使用 count(distinct left(列名, 索引长度))/count(*)的区分度 来确定。
</code></pre>

<p><strong>[强制]页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。</strong></p>

<p>说明：</p>

<pre><code class="language-java">索引文件具有 B-Tree 的最左前缀匹配特性，如果左边的值未确定，那么无法使用此索 引。
</code></pre>

<p><strong>[推荐]如果有 order by 的场景，请注意利用索引的有序性。order by 最后的字段是组合 索引的一部分，并且放在索引组合顺序的最后，避免出现 file_sort 的情况，影响查询性能。</strong></p>

<p>正例：</p>

<pre><code class="language-sql">where a=? and b=? order by c; 索引：a_b_c
</code></pre>

<p>反例：</p>

<pre><code class="language-java">索引中有范围查找，那么索引有序性无法利用，如：WHERE a&gt;10 ORDER BY b; 索引 a_b 无法排序。
</code></pre>

<p><strong>[推荐]利用覆盖索引来进行查询操作，避免回表。</strong></p>

<p>说明：</p>

<pre><code class="language-java">如果一本书需要知道第 11 章是什么标题，会翻开第 11 章对应的那一页吗？目录浏览 一下就好，这个目录就是起到覆盖索引的作用。 
</code></pre>

<p>正例：</p>

<pre><code class="language-java">能够建立索引的种类：主键索引、唯一索引、普通索引，而覆盖索引是一种查询的一种 效果，用 explain 的结果，extra 列会出现：using index。
</code></pre>

<p><strong>[推荐]利用延迟关联或者子查询优化超多分页场景。</strong></p>

<p>说明：</p>

<pre><code class="language-sql">MySQL 并不是跳过 offset 行，而是取 offset+N 行，然后返回放弃前 offset 行，返回 N 行，那当 offset 特别大的时候，效率就非常的低下，要么控制返回的总页数，要么对超过 特定阈值的页数进行 SQL 改写。 
</code></pre>

<p>正例：</p>

<pre><code class="language-sql">先快速定位需要获取的 id 段，然后再关联：
SELECT a.* FROM 表 1 a, (select id from 表 1 where 条件 LIMIT 100000,20 ) b where a.id=b.id
</code></pre>

<p>[推荐]建组合索引的时候，区分度最高的在最左边。</p>

<p>正例：</p>

<pre><code class="language-sql">如果 where a=? and b=? ，a 列的几乎接近于唯一值，那么只需要单建 idx_a 索引即 可。 
</code></pre>

<p>说明：</p>

<pre><code class="language-sql">存在非等号和等号混合判断条件时，在建索引时，请把等号条件的列前置。如：where a&gt;? and b=? 那么即使 a 的区分度更高，也必须把 b 放在索引的最前列。
</code></pre>

<p><strong>[参考]创建索引时避免有如下极端误解：</strong></p>

<pre><code class="language-java">1）宁滥勿缺。认为一个查询就需要建一个索引。

2）宁缺勿滥。认为索引会消耗空间、严重拖慢更新和新增速度。 

3）抵制惟一索引。认为业务的惟一性一律需要在应用层通过“先查后插”方式解决。
</code></pre>

<h2 id="sql-语句">SQL 语句</h2>

<p><strong>[强制]不要使用 count(列名)或 count(常量)来替代 count(<em>)，count(</em>)是 SQL92 定义的标准统计行数的语法，跟数据库无关，跟 NULL 和非 NULL 无关。 说明：count(*)会统计值为 NULL 的行，而 count(列名)不会统计此列为 NULL 值的行。</strong></p>

<p><strong>[强制]count(distinct col) 计算该列除 NULL 之外的不重复行数，注意 count(di col1, col2) 如果其中一列全为 NULL，那么即使另一列有不同的值，也返回为 0。</strong></p>

<p><strong>[强制]当某一列的值全是 NULL 时，count(col)的返回结果为 0，但 sum(col)的返回结果为NULL，因此使用 sum()时需注意 NPE 问题。</strong></p>

<p>正例：</p>

<pre><code class="language-sql">可以使用如下方式来避免 sum 的 NPE 问题：SELECT IF(ISNULL(SUM(g)),0,SUM(g)) FROM table;
</code></pre>

<p><strong>[强制]使用 ISNULL()来判断是否为 NULL 值。</strong></p>

<p>说明：</p>

<pre><code class="language-sql">NULL 与任何值的直接比较都为 NULL。 
1） NULL&lt;&gt;NULL 的返回结果是 NULL，而不是 false。
2） NULL=NULL 的返回结果是 NULL，而不是 true。 
3） NULL&lt;&gt;1 的返回结果是 NULL，而不是 true。
</code></pre>

<p><strong>[强制]不得使用外键与级联，一切外键概念必须在应用层解决。</strong></p>

<p>说明：</p>

<pre><code>以学生和成绩的关系为例，学生表中的 student_id 是主键，那么成绩表中的 student_id 则为外键。
如果更新学生表中的 student_id，同时触发成绩表中的 student_id 更新，即为 级联更新。
外键与级联更新适用于单机低并发，不适合分布式、高并发集群；
级联更新是强阻 塞，存在数据库更新风暴的风险；
外键影响数据库的插入速度。
</code></pre>

<p><strong>[强制]禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。</strong></p>

<p><strong>[强制]数据订正时，删除和修改记录时，要先 select，避免出现误删除，确 行更新语句。</strong></p>

<p><strong>[推荐]in 操作能避免则避免，若实在避免不了，需要仔细评估 in 后边的集合元素数量，控 制在 1000 个之内。</strong></p>

<p><strong>[参考]TRUNCATE TABLE 比 DELETE 速度快，且使用的系统和事务日志资源少，但 TRUNCATE无事务且不触发 trigger，有可能造成事故，故不建议在开发代码中使用此语句。</strong></p>

<p>说明：</p>

<pre><code class="language-sql">TRUNCATE TABLE 在功能上与不带 WHERE 子句的 DELETE 语句相同。
</code></pre>

<h2 id="orm-映射">ORM 映射</h2>

<p><strong>[强制]在表查询中，一律不要使用 * 作为查询的字段列表，需要哪些字段必须明确写明。</strong></p>

<p>说明：</p>

<pre><code class="language-sql">1）增加查询分析器解析成本。
2）增减字段容易与 resultMap 配置不一致。
</code></pre>

<p><strong>[强制]POJO 类的布尔属性不能加 is，而数据库字段必须加 is_，要求在 resultMap 中进行 字段与属性之间的映射。</strong></p>

<p>说明：</p>

<pre><code class="language-java">参见定义 POJO 类以及数据库字段定义规定，在&lt;resultMap&gt;中增加映射，是必须的。 在 MyBatis Generator 生成的代码中，需要进行对应的修改。
</code></pre>

<p><strong>[强制]不要用 resultClass 当返回参数，即使所有类属性名与数据库字段一一对应，也需 要定义；反过来，每一个表也必然有一个与之对应。</strong></p>

<p>说明：</p>

<pre><code class="language-java">配置映射关系，使字段与 DO 类解耦，方便维护。
</code></pre>

<p><strong>[强制]sql.xml 配置参数使用：#{}，#param# 不要使用${} 此种方式容易出现 SQL 注入。</strong></p>

<p><strong>[强制]不允许直接拿 HashMap 与 Hashtable 作为查询结果集的输出。</strong></p>

<p>说明：</p>

<pre><code class="language-sql">resultClass=”Hashtable”，会置入字段名和属性值，但是值的类型不可控。
</code></pre>

<p><strong>[强制]更新数据表记录时，必须同时更新记录对应的 gmt_modified 字段值为当前时间。</strong></p>

<p><strong>[推荐]不要写一个大而全的数据更新接口。</strong></p>

<p>传入为 POJO 类，不管是不是自己的目标更新字 段，都进行</p>

<pre><code class="language-sql">update table set c1=value1,c2=value2,c3=value3; 
</code></pre>

<p>这是不对的。<strong>执行 SQL时，不要更新无改动的字段，一是易出错；二是效率低；三是增加 binlog 存储。</strong></p>

<p><strong>[参考]@Transactional 事务不要滥用。事务会影响数据库的 QPS，另外使用事务的地方需 要考虑各方面的回滚方案，包括缓存回滚、搜索引擎回滚、消息补偿、统计修正等。</strong></p>

<h1 id="工程结构">工程结构</h1>

<h2 id="应用分层">应用分层</h2>

<p><strong>[推荐]图中默认上层依赖于下层，箭头关系表示可直接依赖，如：开放接口层可以依赖于 Web 层，也可以直接依赖于 Service 层，依此类推：</strong></p>

<p><img src="/img/Xnip2020-05-26_14-39-30.png" alt="Xnip2020-05-26_14-39-30" /></p>

<p><strong>开放接口层：</strong>可直接封装 Service 方法暴露成 RPC 接口；通过 Web 封装成 http 接口；进行 网关安全控制、流量控制等。</p>

<p><strong>终端显示层：</strong>各个端的模板渲染并执行显示的层。当前主要是 velocity 渲染，JS 渲染， JSP 渲染，移动端展示等。</p>

<p><strong>Web 层：</strong>主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。</p>

<p><strong>Service 层：</strong>相对具体的业务逻辑服务层。</p>

<p><strong>Manager 层</strong>：通用业务处理层，它有如下特征：</p>

<p>​                      1） 对第三方平台封装的层，预处理返回结果及转化异常信息；</p>

<p>​                      2） 对 Service 层通用能力的下沉，如缓存方案、中间件通用处理；</p>

<p>​                      3） 与 DAO 层交互，对多个 DAO 的组合复用。</p>

<p><strong>DAO 层：</strong>数据访问层，与底层 MySQL、Oracle、Hbase 等进行数据交互。</p>

<p><strong>外部接口或第三方平台：</strong>包括其它部门 RPC 开放接口，基础平台，其它公司的 HTTP 接口。</p>

<p><strong>[参考] （分层异常处理规约）在 DAO 层，产生的异常类型有很多，无法用 行 catch，使用 catch(Exception e)方式，并 throw new DAOException(e)，不需要打印日志，因为日志在 Manager/Service 层一定需要捕获并打到日志文件中去，</strong></p>

<p>如果同台服务器 再打日志，浪费性能和存储。在 Service 层出现异常时，必须记录出错日志到磁盘，尽可能带 上参数信息，相当于保护案发现场。</p>

<p>如果 Manager 层与 Service 同机部署，日志方式与 DAO 层处理一致，如果是单独部署，则采用与 Service 一致的处理方式。Web 层绝不应该继续往上抛异常，因为已经处于顶层，如果意识到这个异常将导致页面无法正常渲染，那么就应该直接 跳转到友好错误页面，加上用户容易理解的错误提示信息。开放接口层要将异常处理成错误码 和错误信息方式返回。</p>

<p><strong>[参考]分层领域模型规约：</strong></p>

<ul>
<li><p><strong>DO（Data Object）</strong>：与数据库表结构一一对应，通过 DAO 层向上传输数据源对象。</p></li>

<li><p><strong>DTO（Data Transfer Object）：</strong>数据传输对象，Service 或 Manager 向外传输的对象。</p></li>

<li><p><strong>BO（Business Object）：</strong>业务对象。由 Service 层输出的封装业务逻辑的对象。</p></li>

<li><p><strong>VO（View Object）：</strong>显示层对象，通常是 Web 向模板渲染引擎层传输的对象。</p></li>

<li><p><strong>Query：</strong>数据查询对象，各层接收上层的查询请求。注意超过 2 个参数的查询封装，禁止 使用 Map 类来传输。</p></li>

<li><p><strong>AO（Application Object）：</strong>应用对象。在 Web 层与 Service 层之间抽象的复用对象模型，</p></li>
</ul>

<p>极为贴近展示层，复用度不高。</p>

<h1 id="服务器">服务器</h1>

<p><strong>[推荐]高并发服务器建议调小 TCP 协议的 time_wait 超时时间</strong></p>

<p>说明：</p>

<pre><code class="language-shell">操作系统默认 240 秒后，才会关闭处于 time_wait 状态的连接，在高并发访问下，服 务器端会因为处于 time_wait 的连接数太多，可能无法建立新的连接，所以需要在服务器上 调小此等待值。 
</code></pre>

<p>正例：</p>

<pre><code class="language-shell">在 linux 服务器上请通过变更/etc/sysctl.conf 文件去修改该缺省值（秒）： net.ipv4.tcp_fin_timeout = 30
</code></pre>

<p><strong>[推荐]调大服务器所支持的最大文件句柄数（File Descriptor，简写为 fd）。</strong></p>

<p>说明：</p>

<pre><code class="language-shell">主流操作系统的设计是将 TCP/UDP 连接采用与文件一样的方式去管理，即一个连接对 应于一个 fd。主流的 linux 服务器默认所支持最大 fd 数量为 1024，当并发连接数很大时很 容易因为 fd 不足而出现“open too many files”错误，导致新的连接无法建立。 建议将 linux 服务器所支持的最大句柄数调高数倍（与服务器的内存数量相关）。
</code></pre>

<p><strong>[推荐]给 JVM 设置-XX:+HeapDumpOnOutOfMemoryError 参数，让 JVM 碰到 OOM 场景时输出 dump 信息。</strong></p>

<p>说明：</p>

<pre><code class="language-java">OOM 的发生是有概率的，甚至有规律地相隔数月才出现一例，出现时的现场信息对查错 非常有价值。
</code></pre>

<p><strong>[推荐]在线上生产环境，JVM 的 Xms 和 Xmx 设置一样大小的内存容量，避免在 GC 后 大小带来的压力。</strong></p>


                
                
<div class="entry-shang text-center">
    
	    <p>「真诚赞赏，手留余香」</p>
	
	<button class="zs show-zs btn btn-bred">赞赏支持</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">×</button>
		<span class="author"><a href="http://maizitoday.github.io/"><img src="/img/favicon.png" /></a></span>
        
	        <p class="tip"><i></i><span>真诚赞赏，手留余香</span></p>
		
 
	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2元</button>
			<button class="btn btn-blink" data-num="5">5元</button>
			<button class="btn btn-blink" data-num="10">10元</button>
			<button class="btn btn-blink" data-num="50">50元</button>
			<button class="btn btn-blink" data-num="100">100元</button>
			<button class="btn btn-blink" data-num="1">任意金额</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2元</button>
			<p>使用<span id="pay-type">微信</span>扫描二维码完成支付</p>
			<img src="/img/reward/wechat-2.png"  id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
		<label><input type="radio" name="zs-type" value="wechat" class="zs-type" checked="checked"><span ><span class="zs-wechat"><img src="/img/reward/wechat-btn.png"/></span></label>
		<label><input type="radio" name="zs-type" value="alipay" class="zs-type" class="zs-alipay"><img src="/img/reward/alipay-btn.png"/></span></label>
	</div>
</div>
<script type="text/javascript" src="/js/reward.js"></script>

                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/netty-rpc/" data-toggle="tooltip" data-placement="top"
                            title="Netty-RPC">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/%E9%9D%A2%E8%AF%95%E9%A2%98%E7%B3%BB%E5%88%97-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" data-toggle="tooltip" data-placement="top"
                            title="面试题系列-并发编程">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                <br>
                <br>
                
                <div class="post-comment">
                    
                    




<div id="vcomments"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<script type="text/javascript">
    new Valine({
        el: '#vcomments',
        appId: 'TOFo2eBmg8VaNWIaluOWCqTS-gzGzoHsz',
        appKey: 'sLvSskmSoBDbCQsBJ8TUhF4k',
        notify: 'false',
        verify: 'false',
        avatar: 'monsterid',
        placeholder: '说点什么吧...',
        visitor: 'true'
    });
</script>
                </div>



            </div>

            
            <div class="
            col-lg-4 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h4>
                        <a class="catalog-toggle" style="font-size: 24px;" href="index.html#">目录结构</a>
                    </h4>
                    <ul class="catalog-body"></ul>
                    <nav id="TableOfContents">
<ul>
<li><a href="#编程规范">编程规范</a>
<ul>
<li><a href="#命名风格">命名风格</a>
<ul>
<li><a href="#参考-各层命名规约"><strong>[参考]各层命名规约：</strong></a></li>
</ul></li>
<li><a href="#常量定义">常量定义</a></li>
<li><a href="#代码格式">代码格式</a></li>
<li><a href="#oop-规约">OOP 规约</a>
<ul>
<li><a href="#关于基本数据类型与包装数据类型的使用标准如下">关于基本数据类型与包装数据类型的使用标准如下：</a></li>
</ul></li>
<li><a href="#集合处理">集合处理</a></li>
<li><a href="#并发处理">并发处理</a></li>
<li><a href="#注释规约">注释规约</a></li>
<li><a href="#其它">其它</a></li>
</ul></li>
<li><a href="#异常日志">异常日志</a>
<ul>
<li><a href="#异常处理">异常处理</a></li>
<li><a href="#日志规约">日志规约</a></li>
</ul></li>
<li><a href="#mysql-数据库">MySQL 数据库</a>
<ul>
<li><a href="#建表规约">建表规约</a></li>
<li><a href="#索引规约">索引规约</a></li>
<li><a href="#sql-语句">SQL 语句</a></li>
<li><a href="#orm-映射">ORM 映射</a></li>
</ul></li>
<li><a href="#工程结构">工程结构</a>
<ul>
<li><a href="#应用分层">应用分层</a></li>
</ul></li>
<li><a href="#服务器">服务器</a></li>
</ul>
</nav>
                    <br>
                    <br>
                    <br>
                    <hr class="hidden-sm hidden-xs">
                </div>
            </div>


            
            <div class="
                col-lg-10 col-lg-offset-0
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/qt" title="QT">
                            QT
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/zookeeper" title="Zookeeper">
                            Zookeeper
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/elasticsearch" title="elasticSearch">
                            elasticSearch
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/golang" title="golang">
                            golang
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/java%E5%9F%BA%E7%A1%80" title="java基础">
                            java基础
                        </a>
                        
                        
                        
                        <a href="/tags/java%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5" title="java相关概念">
                            java相关概念
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/jvm" title="jvm">
                            jvm
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/maven" title="maven">
                            maven
                        </a>
                        
                        
                        
                        <a href="/tags/mongodb" title="mongodb">
                            mongodb
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/mybatis%E7%B3%BB%E5%88%97" title="mybatis系列">
                            mybatis系列
                        </a>
                        
                        
                        
                        <a href="/tags/mycat" title="mycat">
                            mycat
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/mysql%E7%B3%BB%E5%88%97" title="mysql系列">
                            mysql系列
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/nginx" title="nginx">
                            nginx
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/redis" title="redis">
                            redis
                        </a>
                        
                        
                        
                        <a href="/tags/rocketmq" title="rocketmq">
                            rocketmq
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/shell" title="shell">
                            shell
                        </a>
                        
                        
                        
                        <a href="/tags/shiro" title="shiro">
                            shiro
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/springcloud" title="springCloud">
                            springCloud
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/springboot" title="springboot">
                            springboot
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/springboot%E7%B3%BB%E5%88%97" title="springboot系列">
                            springboot系列
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E4%BA%8B%E7%89%A9" title="事物">
                            事物
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E5%88%97" title="分布式系列">
                            分布式系列
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95" title="单点登录">
                            单点登录
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E9%AB%98%E5%B9%B6%E5%8F%91" title="多线程和高并发">
                            多线程和高并发
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7" title="开发工具">
                            开发工具
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93" title="数据库">
                            数据库
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" title="数据结构">
                            数据结构
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B" title="网络编程">
                            网络编程
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" title="设计模式">
                            设计模式
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1" title="负载均衡">
                            负载均衡
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98%E7%B3%BB%E5%88%97" title="面试题系列">
                            面试题系列
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>FRIENDS</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href="https://zhaohuabing.com">赵化冰博客</a></li>
                        
                        <li><a target="_blank" href="http://www.tianshouzhi.com">田守枝</a></li>
                        
                        <li><a target="_blank" href="http://www.ityouknow.com">纯洁的微笑</a></li>
                        
                        <li><a target="_blank" href="https://renchunxiao.com">任春晓</a></li>
                        
                        <li><a target="_blank" href="https://www.lihongkun.com">泛泛之辈</a></li>
                        
                        <li><a target="_blank" href="https://juejin.im/welcome/backend">后端服务论坛</a></li>
                        
                        <li><a target="_blank" href="https://www.javaboy.org">江南一点雨</a></li>
                        
                        <li><a target="_blank" href="https://blog.csdn.net/gwd1154978352">东天里的冬天</a></li>
                        
                        <li><a target="_blank" href="https://www.javazhiyin.com/">java知音</a></li>
                        
                        <li><a target="_blank" href="https://juejin.im/user/5b2cc5fee51d4553156be12f/posts">算法</a></li>
                        
                        <li><a target="_blank" href="https://www.zhihu.com/people/duan-pan-ykjym">勤劳的小手</a></li>
                        
                        <li><a target="_blank" href="https://cloud.tencent.com/developer/user/2728002">Java团长</a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>



<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:maiziybtoday@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    <li>
                        <a target="_blank" href="/your%20wechat%20qr%20code%20image">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-wechat fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/yourlinkedinid">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy;  2020
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
