<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="http://maizitoday.github.io//img/home-bg-jeep.jpg">
    <meta property="twitter:image" content="http://maizitoday.github.io//img/home-bg-jeep.jpg" />
    

    
    <meta name="title" content="mysql系列-非索引设计与单表查询优化" />
    <meta property="og:title" content="mysql系列-非索引设计与单表查询优化" />
    <meta property="twitter:title" content="mysql系列-非索引设计与单表查询优化" />
    

    
    <meta name="description" content="麦子，程序员, 开源爱好者，生活探险家 | 这里是 麦子 的博客，与你一起发现更大的世界。">
    <meta property="og:description" content="麦子，程序员, 开源爱好者，生活探险家 | 这里是 麦子 的博客，与你一起发现更大的世界。" />
    <meta property="twitter:description" content="麦子，程序员, 开源爱好者，生活探险家 | 这里是 麦子 的博客，与你一起发现更大的世界。" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="麦子, maizi, maizi, , 麦子的网络日志, 麦子的博客, maizi Blog, 博客, 个人网站, 互联网, Web, 云原生, PaaS, Istio, Kubernetes, 微服务, Microservice">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>mysql系列-非索引设计与单表查询优化-麦子的博客</title>

    <link rel="canonical" href="/post/mysql%E7%B3%BB%E5%88%97-%E6%9F%A5%E6%89%BE%E4%BC%98%E5%8C%96-%E9%9D%9E%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/syntax.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>
	
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/docco.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"></a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/categories/life">Life</a>
                    </li>
                    
                    <li>
                        <a href="/categories/tech">Tech</a>
                    </li>
                    

                    
                    <li><a href="/top/about/">ABOUT</a></li>
                    


                    
                    <li>
                        <a href="/archive">ARCHIVE</a>
                    </li>
                    


                    
                    <li>
                        <a href="/search">SEARCH <img src="/img/search.png" height="15"
                                style="cursor: pointer;" alt="Search"></a>
                    </li>
                    

                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)

    function handleMagic(e) {
        if ($navbar.className.indexOf('in') > 0) {
            
            $navbar.className = " ";
            
            setTimeout(function () {
                
                if ($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            }, 400)
        } else {
            
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>



<style type="text/css">
    header.intro-header {
        background-image: url('https://c.pxhere.com/images/e8/66/3d717bad8449de9495d9c9761d57-1423465.jpg!d')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/mysql%E7%B3%BB%E5%88%97" title="mysql系列">
                            mysql系列
                        </a>
                        
                        <a class="tag" href="/tags/%E5%BA%93%E4%B8%8E%E8%A1%A8%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C" title="库与表基本操作">
                            库与表基本操作
                        </a>
                        
                        <a class="tag" href="/tags/%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%88%A0%E6%94%B9" title="数据增删改">
                            数据增删改
                        </a>
                        
                        <a class="tag" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93" title="数据库">
                            数据库
                        </a>
                        
                    </div>
                    <h1>mysql系列-非索引设计与单表查询优化</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
			Posted by 
			
			         &#34;麦子&#34;
			 
			on 
			Monday, August 26, 2019
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2>TOC</h2>
                </header>              
                <nav id="TableOfContents">
<ul>
<li><a href="#明确搜索优化的整体思路">明确搜索优化的整体思路</a></li>
<li><a href="#查询优化的因素">查询优化的因素</a>
<ul>
<li><a href="#是否向数据库请求了不需要的数据">是否向数据库请求了不需要的数据</a></li>
<li><a href="#mysql是否扫描额外的纪录">mysql是否扫描额外的纪录</a>
<ul>
<li><a href="#响应时间">响应时间</a></li>
<li><a href="#扫描的行数和返回的行数">扫描的行数和返回的行数</a></li>
<li><a href="#扫描的行数和访问类型">扫描的行数和访问类型</a></li>
</ul></li>
<li><a href="#查询的流程">查询的流程</a></li>
</ul></li>
<li><a href="#优化查询前的几个工具">优化查询前的几个工具</a>
<ul>
<li><a href="#查看mysql整体状态">查看MySQL整体状态</a></li>
<li><a href="#慢查询">慢查询</a>
<ul>
<li><a href="#查询日志格式">查询日志格式</a></li>
<li><a href="#开启慢查询日志">开启慢查询日志</a>
<ul>
<li><a href="#配置文件修改">配置文件修改</a></li>
<li><a href="#查看日志启动状态">查看日志启动状态</a></li>
<li><a href="#设置慢日志开启">设置慢日志开启</a></li>
<li><a href="#查询long-query-time-的值">查询long_query_time 的值</a></li>
</ul></li>
<li><a href="#explain查询分析">explain查询分析</a>
<ul>
<li><a href="#select-type">select_type</a></li>
<li><a href="#table">Table</a></li>
<li><a href="#type-这是最重要的字段之一">type：这是最重要的字段之一</a>
<ul>
<li><a href="#null">NULL</a></li>
<li><a href="#system-const">system、const</a></li>
<li><a href="#eq-ref">eq_ref</a></li>
<li><a href="#ref">ref</a></li>
<li><a href="#range">range</a></li>
<li><a href="#index">index</a></li>
<li><a href="#all">ALL</a></li>
</ul></li>
<li><a href="#possible-keys">possible_keys</a></li>
<li><a href="#key">key</a></li>
<li><a href="#key-len">key_len</a></li>
<li><a href="#ref-1">ref</a></li>
<li><a href="#rows">rows</a></li>
<li><a href="#extra-关于mysql如何解析查询的额外信息">Extra：关于MYSQL如何解析查询的额外信息</a>
<ul>
<li><a href="#using-index">using index</a></li>
<li><a href="#using-where">using where</a></li>
<li><a href="#using-tmporary">using tmporary</a></li>
<li><a href="#using-filesort">using filesort</a></li>
<li><a href="#range-checked-for-eache-record-index-map-n">range checked for eache record(index map:N)</a></li>
<li><a href="#using-join-buffer">Using join buffer</a></li>
<li><a href="#impossible-where">Impossible where</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#profiling查询分析">profiling查询分析</a>
<ul>
<li><a href="#打开profiling查询分析">打开profiling查询分析</a></li>
</ul></li>
</ul></li>
<li><a href="#单表查询步步优化-暂不讨论索引">单表查询步步优化(暂不讨论索引)</a>
<ul>
<li>
<ul>
<li><a href="#1-明确需要的字段-要多少就写多少字段">1.  明确需要的字段，要多少就写多少字段。</a></li>
<li><a href="#2-使用分页语句优化">2.  使用分页语句优化</a></li>
<li><a href="#3-如果是有序的查询-可使用order-by">3.  如果是有序的查询，可使用ORDER BY</a></li>
<li><a href="#4-开启查询缓存">4. 开启查询缓存</a>
<ul>
<li><a href="#命中缓存条件">命中缓存条件</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
                
                

<p>[TOC]</p>

<p><strong>转载地址：<a href="https://blog.csdn.net/jack__frost/article/details/71512404">https://blog.csdn.net/jack__frost/article/details/71512404</a></strong></p>

<h1 id="明确搜索优化的整体思路">明确搜索优化的整体思路</h1>

<p>索引优化，查询优化，查询缓存，服务器设置优化，操作系统和硬件优化，应用层面优化（web服务器，缓存）等等。对于一个整体项目而言只有这些齐头并进，才能实现mysql高性能。</p>

<h1 id="查询优化的因素">查询优化的因素</h1>

<h2 id="是否向数据库请求了不需要的数据">是否向数据库请求了不需要的数据</h2>

<p>也就是说不要轻易使用select * from ，能明确多少数据就查多少个。</p>

<h2 id="mysql是否扫描额外的纪录">mysql是否扫描额外的纪录</h2>

<p>查询是否扫描了过多的数据。最简单的衡量查询开销三个指标如下：响应时间；扫描的行数；返回的行数。</p>

<p>没有哪个指标能够完美地衡量查询的开销，但它们大致反映了mysql在内部执行查询时需要多少数据，并可以推算出查询运行的时间。</p>

<p><strong>这三个指标都会记录到mysql的慢日志中，所以检查慢日志记录是找出扫描行数过多的查询的好办法。</strong></p>

<h3 id="响应时间">响应时间</h3>

<p>是两个部分之和：服务时间和排队时间。服务时间是指数据库处理这个查询真正花了多长时间。 排队时间是指服务器因为等待某些资源而没有真正执行查询的时间。—可能是等io操作完成，也可能是等待行锁，等等。</p>

<h3 id="扫描的行数和返回的行数">扫描的行数和返回的行数</h3>

<p>：分析查询时，查看该查询扫描的行数是非常有帮助的。这在一定程度上能够说明该查询找到需要的数据的效率高不高。</p>

<h3 id="扫描的行数和访问类型">扫描的行数和访问类型</h3>

<p>在<strong>expain</strong>语句中的type列反应了访问类型。访问类型有很多种，从全表扫描（ALL）到索引扫描（index）到范围扫描（）到唯一索引查询到常数引用等。这里列的这些，速度由慢到快，扫描的行数也是从小到大。</p>

<p><strong>如果发现查询需要扫描大量的数据但只返回少数的行，那么通常可以尝试下面的技巧去优化它：</strong></p>

<ol>
<li>使用索引覆盖扫描。</li>
<li>改变库表结构。例如使用单独的汇总表。</li>
<li>重写这个复杂的查询。让mysql优化器能够以更优化的方式执行这个查询。</li>
</ol>

<h2 id="查询的流程">查询的流程</h2>

<ol>
<li>客户端发送一条查询给服务器。</li>
<li>服务器先检查查询缓存，如果命中了缓存，则立刻返回存储在缓存中的结果，否则进入下一阶段。</li>
<li>服务器进行SQL解析，预处理，再由优化器生成对应的执行计划。</li>
<li>mysql根据优化器生成的执行计划，调用存储引擎的API来执行查询。</li>
<li>将结果返回给客户端。</li>
</ol>

<h1 id="优化查询前的几个工具">优化查询前的几个工具</h1>

<h2 id="查看mysql整体状态">查看MySQL整体状态</h2>

<pre><code class="language-sql">Mysql&gt; show status; ——显示状态信息（扩展show status like ‘XXX’）
Mysql&gt;show variables ——显示系统变量（扩展show variables like ‘XXX’）
Mysql&gt;show innodb status ——显示InnoDB存储引擎的状态
Mysql&gt;show processlist ——查看当前SQL执行，包括执行状态、是否锁表等
</code></pre>

<pre><code class="language-shell">Shell&gt; mysqladmin variables -u username -p password——显示系统变量
Shell&gt; mysqladmin extended-status -u username -p password——显示状态信息
Shell&gt; mysqld –verbose –help [|more #逐行显示] 查看状态变量及帮助：
</code></pre>

<h2 id="慢查询">慢查询</h2>

<pre><code class="language-shell"># 查看慢查日志是否开启
SHOW VARIABLES  LIKE 'slow_query_log';
SET GLOBAL slow_query_log=on;

# 查看是否没有使用索引的查询记录
SHOW VARIABLES LIKE 'log%';
# 开启所有查询都记录下来
SET GLOBAL log_queries_not_using_indexes=on;

#查看执行多长时间的语句记录下来。
SHOW VARIABLES LIKE 'long_query_time';
#这个地方设置后，需要重新开启一个终端才可以看到效果
set global long_query_time=0;

#查看慢日志的具体文件
SHOW  VARIABLES LIKE 'slow%'
</code></pre>

<h3 id="查询日志格式">查询日志格式</h3>

<pre><code class="language-shell">#查看慢日志的具体文件
SHOW  VARIABLES LIKE 'slow%'

SET timestamp=1558163795;
/* ApplicationName=DataGrip 2017.2.2 */ SET SQL_SELECT_LIMIT=12;
# User@Host: root[root] @  [172.17.0.1]  Id:    78
# Query_time: 0.000247  Lock_time: 0.000102 Rows_sent: 1  Rows_examined: 2
SET timestamp=1558163795;
/* ApplicationName=DataGrip 2017.2.2 */ SELECT * FROM work.PDMAN_DB_VERSION WHERE DB_VERSION = 'v1.0.4';
</code></pre>

<h3 id="开启慢查询日志">开启慢查询日志</h3>

<h4 id="配置文件修改">配置文件修改</h4>

<p>配置文件修改，在配置文件my.cnf或my.ini中在[mysqld]一行下面加入两个配置参数。</p>

<pre><code class="language-shell">log-slow-queries={自己想存放的日志路径}/slow-query.log
long_query_time=10 //表示查询超过10秒才记录；
</code></pre>

<p>注：log-slow-queries参数为慢查询日志存放的位置，一般这个目录要有mysql的运行帐号的可写权限，一般都将这个目录设置为mysql的数据存放目录；</p>

<h4 id="查看日志启动状态">查看日志启动状态</h4>

<pre><code class="language-sql">show variables like “slow%”;
</code></pre>

<table>
<thead>
<tr>
<th>slow_launch_time</th>
<th>2</th>
</tr>
</thead>

<tbody>
<tr>
<td>slow_query_log</td>
<td>OFF</td>
</tr>

<tr>
<td>slow_query_log_file</td>
<td>/var/lib/mysql/63c0513730d7-slow.log</td>
</tr>
</tbody>
</table>

<h4 id="设置慢日志开启">设置慢日志开启</h4>

<pre><code class="language-sql">set global slow_query_log = ON;
</code></pre>

<table>
<thead>
<tr>
<th>slow_launch_time</th>
<th>2</th>
</tr>
</thead>

<tbody>
<tr>
<td>slow_query_log</td>
<td>ON</td>
</tr>

<tr>
<td>slow_query_log_file</td>
<td>/var/lib/mysql/63c0513730d7-slow.log</td>
</tr>
</tbody>
</table>

<h4 id="查询long-query-time-的值">查询long_query_time 的值</h4>

<pre><code class="language-sql">show variables like “long%”;
</code></pre>

<table>
<thead>
<tr>
<th>long_query_time</th>
<th>10.000000</th>
</tr>
</thead>

<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>

<h3 id="explain查询分析">explain查询分析</h3>

<p><img src="/img/5-19-3.png" alt="5-19-3" /></p>

<p><img src="/img/5-19-4.png" alt="5-19-4" /></p>

<p>使用 EXPLAIN 关键字可以模拟优化器执行SQL查询语句，通过explain命令可以得到:</p>

<ol>
<li>表的读取顺序</li>
<li>数据读取操作的操作类型</li>
<li>哪些索引可以使用</li>
<li>哪些索引被实际使用</li>
<li>表之间的引用</li>
<li>每张表有多少行被优化器查询</li>
</ol>

<p>示例如下：</p>

<pre><code class="language-sql">ALTER TABLE school.student add index age_index (age); // 添加索引 
explain select * from school.student where age = 5;
</code></pre>

<table>
<thead>
<tr>
<th>select_type</th>
<th>Table</th>
<th>partitions</th>
<th>Type</th>
<th>possible_keys</th>
<th>Key</th>
<th>key_len</th>
<th>ref</th>
<th>rows</th>
<th>filtered</th>
<th>Extra</th>
</tr>
</thead>

<tbody>
<tr>
<td>SIMPLE</td>
<td>student</td>
<td></td>
<td>ref</td>
<td>age_index</td>
<td>age_index</td>
<td>5</td>
<td>const</td>
<td>1</td>
<td>100.0</td>
<td></td>
</tr>
</tbody>
</table>

<h4 id="select-type">select_type</h4>

<p>查询中每个select子句的类型，</p>

<ol>
<li>SIMPLE(简单SELECT,不使用UNION或子查询等)</li>
<li>PRIMARY(查询中若包含任何复杂的子部分,最外层的select被标记为PRIMARY)</li>
<li>UNION(UNION中的第二个或后面的SELECT语句)</li>
<li>DEPENDENT UNION(UNION中的第二个或后面的SELECT语句，取决于外面的查询)</li>
<li>UNION RESULT(UNION的结果)</li>
<li>SUBQUERY(子查询中的第一个SELECT)</li>
<li>DEPENDENT SUBQUERY(子查询中的第一个SELECT，取决于外面的查询)</li>
<li>DERIVED(派生表的SELECT, FROM子句的子查询)</li>
<li>UNCACHEABLE SUBQUERY(一个子查询的结果不能被缓存，必须重新评估外链接的第一行)
<br /></li>
</ol>

<h4 id="table">Table</h4>

<p>显示这一行的数据是关于哪张表的。</p>

<h4 id="type-这是最重要的字段之一">type：这是最重要的字段之一</h4>

<p>显示查询使用了何种类型。从最好到最差的连接类型为NULL、system、const、eq_ref、ref、range、index和ALL。</p>

<h5 id="null">NULL</h5>

<p>MySQL在优化过程中分解语句，执行时甚至不用访问表或索引，例如从一个索引列里选取最小值可以通过单独索引查找完成。</p>

<h5 id="system-const">system、const</h5>

<p>可以将查询的变量转为常量. 如id=1; id为 主键或唯一键。当MySQL对查询某部分进行优化，并转换为一个常量时，使用这些类型访问。如将主键置于where列表中，MySQL就能将该查询转换为一个常量,system是const类型的特例，当查询的表只有一行的情况下，使用system。</p>

<h5 id="eq-ref">eq_ref</h5>

<p>访问索引,返回某单一行的数据.(通常在联接时出现，查询使用的索引为主键或惟一键)。类似ref，区别就在使用的索引是唯一索引，对于每个索引键值，表中只有一条记录匹配，简单来说，就是多表连接中使用primary key或者 unique key作为关联条件。</p>

<h5 id="ref">ref</h5>

<p>访问索引,返回某个值的数据.(可以返回多行) 通常使用=时发生。表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值。</p>

<h5 id="range">range</h5>

<p>这个连接类型使用索引返回一个范围中的行，比如使用&gt;或&lt;查找东西，并且该字段上建有索引时发生的情况(注:不一定好于index)。只检索给定范围的行，使用一个索引来选择行。</p>

<h5 id="index">index</h5>

<p>以索引的顺序进行全表扫描，优点是不用排序,缺点是还要全表扫描。index与ALL区别为index类型只遍历索引树。</p>

<h5 id="all">ALL</h5>

<p>全表扫描，应该尽量避免。 MySQL将遍历全表以找到匹配的行。</p>

<h4 id="possible-keys">possible_keys</h4>

<p>显示可能应用在这张表中的索引。如果为空，没有可能的索引。可以为相关的域从WHERE语句中选择一个合适的语句。如果该列是NULL，则没有相关的索引。在这种情况下，可以通过检查WHERE子句看是否它引用某些列或适合索引的列来提高你的查询性能。如果是这样，创造一个适当的索引并且再次用EXPLAIN检查查询。</p>

<h4 id="key">key</h4>

<p>实际使用的索引。如果为NULL，则没有使用索引。</p>

<h4 id="key-len">key_len</h4>

<p>在不损失精确性的情况下，长度越短越好。表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度（key_len显示的值为索引字段的最大可能长度，并非实际使用长度，即key_len是根据表定义计算而得，不是通过表内检索出的）。</p>

<h4 id="ref-1">ref</h4>

<p>显示索引的哪一列被使用了，如果可能的话，是一个常数。</p>

<h4 id="rows">rows</h4>

<p>MySQL认为必须检索的用来返回请求数据的行数，表示MySQL根据表统计信息及索引选用情况，估算的找到所需的记录所需要读取的行数。</p>

<h4 id="extra-关于mysql如何解析查询的额外信息">Extra：关于MYSQL如何解析查询的额外信息</h4>

<h5 id="using-index">using index</h5>

<p>只用到索引,可以避免访问表.。表示查询在索引树中就可查找所需数据, 不用扫描表数据文件, <strong>往往说明性能不错</strong>。</p>

<h5 id="using-where">using where</h5>

<p>使用到where来过虑数据. 不是所有的where clause都要显示using where. 如以=方式访问索引.</p>

<h5 id="using-tmporary">using tmporary</h5>

<p>查询有使用临时表, 一般出现于排序, 分组和多表 join 的情况, 查询效率不高, <strong>建议优化</strong>.</p>

<h5 id="using-filesort">using filesort</h5>

<p>用到额外的排序. (当使用order by v1,而没用到索引时,就会使用额外的排序)。MySQL中无法利用索引完成的排序操作称为“文件排序”</p>

<h5 id="range-checked-for-eache-record-index-map-n">range checked for eache record(index map:N)</h5>

<p>没有好的索引.</p>

<h5 id="using-join-buffer">Using join buffer</h5>

<p>改值强调了在获取连接条件时没有使用索引，并且需要连接缓冲区来存储中间结果。<strong>如果出现了这个值，那应该注意，根据查询的具体情况可能需要添加索引来改进能。</strong></p>

<h5 id="impossible-where">Impossible where</h5>

<p>这个值强调了where语句会导致没有符合条件的行。</p>

<h2 id="profiling查询分析">profiling查询分析</h2>

<p>通过慢日志查询可以知道哪些SQL语句执行效率低下，通过explain我们可以得知SQL语句的具体执行情况，索引使用等，还可以结合show命令查看执行状态。</p>

<p>如果觉得explain的信息不够详细，可以同通过profiling命令得到更准确的SQL执行消耗系统资源的信息。</p>

<h3 id="打开profiling查询分析">打开profiling查询分析</h3>

<p>profiling默认是关闭的。可以通过以下语句进行处理查看：</p>

<pre><code class="language-sql">select @@profiling;  // 查看 
 
set profiling = 1;  //  打开 

select * from school.student where age = 5; // 写几条sql

</code></pre>

<p>进行查看具体sql信息如下：</p>

<pre><code class="language-sql">show profiles; //  然后查看最近SQL，可以得到被执行的SQL语句的时间和ID
</code></pre>

<table>
<thead>
<tr>
<th>12</th>
<th>0.00438175</th>
<th>select * from school.student where age = 5</th>
</tr>
</thead>

<tbody>
<tr>
<td>13</td>
<td>3.035E-4</td>
<td>SHOW WARNINGS</td>
</tr>

<tr>
<td>14</td>
<td>5.885E-4</td>
<td>SHOW WARNINGS</td>
</tr>

<tr>
<td>15</td>
<td>2.7525E-4</td>
<td>show profiles\G</td>
</tr>

<tr>
<td>16</td>
<td>3.92E-4</td>
<td>SHOW WARNINGS</td>
</tr>

<tr>
<td>17</td>
<td>1.9925E-4</td>
<td>show profiles\G</td>
</tr>

<tr>
<td>18</td>
<td>3.375E-4</td>
<td>SHOW WARNINGS</td>
</tr>

<tr>
<td>19</td>
<td>2.365E-4</td>
<td>SHOW WARNINGS</td>
</tr>

<tr>
<td>20</td>
<td>2.83E-4</td>
<td>SHOW WARNINGS</td>
</tr>

<tr>
<td>21</td>
<td>3.31E-4</td>
<td>SHOW WARNINGS</td>
</tr>

<tr>
<td>22</td>
<td>3.36E-4</td>
<td>SHOW WARNINGS</td>
</tr>

<tr>
<td>23</td>
<td>3.1E-4</td>
<td>SHOW WARNINGS</td>
</tr>

<tr>
<td>24</td>
<td>0.00100725</td>
<td>SHOW WARNINGS</td>
</tr>

<tr>
<td>25</td>
<td>2.9525E-4</td>
<td>SHOW WARNINGS</td>
</tr>

<tr>
<td>26</td>
<td>3.77E-4</td>
<td>SHOW WARNINGS</td>
</tr>
</tbody>
</table>

<pre><code class="language-sql">show profile for query 12;  // 得到对应SQL语句执行的详细信息
</code></pre>

<table>
<thead>
<tr>
<th>starting</th>
<th>0.000084</th>
</tr>
</thead>

<tbody>
<tr>
<td>Executing hook on transaction</td>
<td>0.000011</td>
</tr>

<tr>
<td>starting</td>
<td>0.000016</td>
</tr>

<tr>
<td>checking permissions</td>
<td>0.000013</td>
</tr>

<tr>
<td>Opening tables</td>
<td>0.000072</td>
</tr>

<tr>
<td>init</td>
<td>0.000023</td>
</tr>

<tr>
<td>System lock</td>
<td>0.000037</td>
</tr>

<tr>
<td>optimizing</td>
<td>0.000027</td>
</tr>

<tr>
<td>statistics</td>
<td>0.000127</td>
</tr>

<tr>
<td>preparing</td>
<td>0.000037</td>
</tr>

<tr>
<td>executing</td>
<td>0.000091</td>
</tr>

<tr>
<td>end</td>
<td>0.000018</td>
</tr>

<tr>
<td>query end</td>
<td>0.000014</td>
</tr>

<tr>
<td>waiting for handler commit</td>
<td>0.000027</td>
</tr>

<tr>
<td>closing tables</td>
<td>0.000062</td>
</tr>

<tr>
<td>freeing items</td>
<td>0.000283</td>
</tr>

<tr>
<td>cleaning up</td>
<td>0.000049</td>
</tr>
</tbody>
</table>

<h1 id="单表查询步步优化-暂不讨论索引">单表查询步步优化(暂不讨论索引)</h1>

<h3 id="1-明确需要的字段-要多少就写多少字段">1.  明确需要的字段，要多少就写多少字段。</h3>

<h3 id="2-使用分页语句优化">2.  使用分页语句优化</h3>

<p>limit start , count 或者条件 where子句。有什么可限制的条件尽量加上，查一条就limit一条。做到不多拿不乱拿。对limit的使用再优化，利用自增主键，避免offset的使用（演示在积分表score，商品表设计得不太好），约是上面方法的1/3时间。</p>

<pre><code class="language-sql">select * from school.student limit 0,1;  

select * from school.student where id &gt; 1 limit 2; 
</code></pre>

<h3 id="3-如果是有序的查询-可使用order-by">3.  如果是有序的查询，可使用ORDER BY</h3>

<pre><code class="language-sql">select *
		from
		score 
		WHERE id&gt;0
		ORDER BY score ASC
		LIMIT 10000
		;
</code></pre>

<h3 id="4-开启查询缓存">4. 开启查询缓存</h3>

<p>大多数的MySQL服务器都开启了查询缓存。这是提高性最有效的方法之一。当有很多相同的查询被执行了多次的时候，这些查询结果会被放到一个缓存中，这样，后续的相同的查询就不用操作表而直接访问缓存结果了。</p>

<h4 id="命中缓存条件">命中缓存条件</h4>

<ol>
<li>缓存存在一个hash表中,通过查询SQL,查询数据库,客户端协议等作为key.在判断是否命中前,MySQL不会解析SQL,而是直接使用SQL去查询缓存,<strong>SQL任何字符上的不同,如空格,注释,都会导致缓存不命中.</strong></li>
<li>如果查询中有不确定数据,<strong>例如CURRENT_DATE()和NOW()函数,那么查询完毕后则不会被缓存</strong>.所以,包含不确定数据的查询是肯定不会找到可用缓存的
<br /></li>
</ol>


                
                
<div class="entry-shang text-center">
    
	    <p>「真诚赞赏，手留余香」</p>
	
	<button class="zs show-zs btn btn-bred">赞赏支持</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">×</button>
		<span class="author"><a href="http://maizitoday.github.io/"><img src="/img/favicon.png" /></a></span>
        
	        <p class="tip"><i></i><span>真诚赞赏，手留余香</span></p>
		
 
	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2元</button>
			<button class="btn btn-blink" data-num="5">5元</button>
			<button class="btn btn-blink" data-num="10">10元</button>
			<button class="btn btn-blink" data-num="50">50元</button>
			<button class="btn btn-blink" data-num="100">100元</button>
			<button class="btn btn-blink" data-num="1">任意金额</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2元</button>
			<p>使用<span id="pay-type">微信</span>扫描二维码完成支付</p>
			<img src="/img/reward/wechat-2.png"  id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
		<label><input type="radio" name="zs-type" value="wechat" class="zs-type" checked="checked"><span ><span class="zs-wechat"><img src="/img/reward/wechat-btn.png"/></span></label>
		<label><input type="radio" name="zs-type" value="alipay" class="zs-type" class="zs-alipay"><img src="/img/reward/alipay-btn.png"/></span></label>
	</div>
</div>
<script type="text/javascript" src="/js/reward.js"></script>

                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/%E6%95%B0%E6%8D%AE%E5%BA%93-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/" data-toggle="tooltip" data-placement="top" title="事务隔离级别">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/mysql%E7%B3%BB%E5%88%97-%E6%9F%A5%E6%89%BE%E4%BC%98%E5%8C%96-%E5%A4%96%E8%BF%9E%E6%8E%A5%E5%A4%9A%E8%A1%A8%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E4%BB%A5%E5%8F%8A%E6%9F%A5%E8%AF%A2%E6%B3%A8%E6%84%8F%E7%82%B9/" data-toggle="tooltip" data-placement="top" title="mysql系列-查找优化、外连接、多表联合查询">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/zookeeper" title="Zookeeper">
                            Zookeeper
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/elasticsearch" title="elasticSearch">
                            elasticSearch
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/java%E5%9F%BA%E7%A1%80" title="java基础">
                            java基础
                        </a>
                        
                        
                        
                        <a href="/tags/java%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5" title="java相关概念">
                            java相关概念
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/jvm" title="jvm">
                            jvm
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/maven" title="maven">
                            maven
                        </a>
                        
                        
                        
                        <a href="/tags/mongodb" title="mongodb">
                            mongodb
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/mybatis%E7%B3%BB%E5%88%97" title="mybatis系列">
                            mybatis系列
                        </a>
                        
                        
                        
                        <a href="/tags/mycat" title="mycat">
                            mycat
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/mysql%E7%B3%BB%E5%88%97" title="mysql系列">
                            mysql系列
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/nginx" title="nginx">
                            nginx
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/redis" title="redis">
                            redis
                        </a>
                        
                        
                        
                        <a href="/tags/rocketmq" title="rocketmq">
                            rocketmq
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/shell" title="shell">
                            shell
                        </a>
                        
                        
                        
                        <a href="/tags/shiro" title="shiro">
                            shiro
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/springcloud" title="springCloud">
                            springCloud
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/springboot%E7%B3%BB%E5%88%97" title="springboot系列">
                            springboot系列
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E5%88%97" title="分布式系列">
                            分布式系列
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95" title="单点登录">
                            单点登录
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E9%AB%98%E5%B9%B6%E5%8F%91" title="多线程和高并发">
                            多线程和高并发
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7" title="开发工具">
                            开发工具
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93" title="数据库">
                            数据库
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" title="数据结构">
                            数据结构
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B" title="网络编程">
                            网络编程
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" title="设计模式">
                            设计模式
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1" title="负载均衡">
                            负载均衡
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>FRIENDS</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href="https://zhaohuabing.com">赵化冰博客</a></li>
                        
                        <li><a target="_blank" href="http://www.tianshouzhi.com">田守枝</a></li>
                        
                        <li><a target="_blank" href="http://www.ityouknow.com">纯洁的微笑</a></li>
                        
                        <li><a target="_blank" href="https://renchunxiao.com">任春晓</a></li>
                        
                        <li><a target="_blank" href="https://www.lihongkun.com">泛泛之辈</a></li>
                        
                        <li><a target="_blank" href="https://juejin.im/welcome/backend">后端服务论坛</a></li>
                        
                        <li><a target="_blank" href="https://www.javaboy.org">江南一点雨</a></li>
                        
                        <li><a target="_blank" href="https://blog.csdn.net/gwd1154978352">东天里的冬天</a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:maiziybtoday@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    <li>
                        <a target="_blank" href="/your%20wechat%20qr%20code%20image">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-wechat fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/yourlinkedinid">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy;  2020
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
